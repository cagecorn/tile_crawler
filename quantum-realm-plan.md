# [미래 계획] 양자 영역 강화 시스템

이 문서는 아이템 강화를 '뱀파이어 서바이벌' 스타일의 미니게임으로 만드는 '양자 영역 강화' 시스템의 기획안입니다.

## 1. 컨셉 (Concept)

-   아이템을 강화하기 위해, 플레이어는 해당 아이템의 내부에 존재하는 '양자 영역'으로 직접 진입합니다.
-   강화 과정은 단순히 재료를 소모하는 클릭이 아닌, 컨트롤과 성장이 필요한 하나의 독립된 미니게임이 됩니다.
-   플레이어가 양자 영역에 진입할 때, 착용하고 있던 장비들이 **의인화**되어 함께 싸우는 **동료**가 됩니다.

## 2. 게임 플레이 (Gameplay)

-   **장르**: 탑다운 시점의 실시간 생존 디펜스 (뱀파이어 서바이벌 류).
-   **목표**: 정해진 시간(예: 3분) 동안, 아이템의 등급과 레벨에 따라 끊임없이 몰려오는 '양자 왜곡체(적)'들로부터 살아남아야 합니다.
-   **조작**: 플레이어는 이동만 조작하며, 공격은 자동으로 이루어집니다.

-   **장비 의인화 동료**:
    -   양자 영역에 진입 시, 플레이어가 착용하고 있던 모든 장비(무기, 갑옷, 장신구 등)가 의인화되어 '동료'로 참전합니다.
    -   동료의 능력치는 원본 장비의 **미시 세계 스탯**을 그대로 따라갑니다.
        -   **HP**: 장비의 `내구도 (Durability)`
        -   **공격력**: 장비의 `무게 (Weight)`
        -   **방어력**: 장비의 `강인함 (Toughness)`
    -   동료들은 플레이어를 따라다니며 각자의 방식으로 자동 공격을 수행합니다.
    -   따라서, 플레이어는 강력하고 좋은 장비를 갖춰 입을수록 양자 영역 탐사를 더 수월하게 진행할 수 있습니다.

-   **성장**:
    -   적을 처치하면 경험치를 얻어 '양자 영역 레벨'이 오릅니다.
    -   레벨업 시, 3개의 무작위 강화 옵션(예: '플레이어 발사체 수 +1', '모든 동료 공격 속도 +10%', '이동 속도 증가' 등) 중 하나를 선택하여 생존 시간 동안 점점 더 강해집니다.

-   **결과**:
    -   **성공**: 생존 시간을 모두 채우면 양자 영역에서 탈출하며, 원래 세계의 아이템이 성공적으로 강화됩니다. (강화 성공도는 양자 영역 내 달성 레벨에 비례할 수 있습니다.)
    -   **실패**: 생존 시간 내에 HP가 0이 되면 강화는 실패하고 원래 세계로 돌아옵니다.

## 3. 기술적 아키텍처 (Architecture)

이 시스템은 기존 게임 엔진과 분리된, 새로운 `QuantumSurvivalEngine`을 중심으로 구축됩니다.

-   **게임 상태 전환**: `game.js`는 `DungeonCrawl`과 `QuantumSurvival` 두 가지 메인 상태를 관리합니다. 아이템 강화 시도 시 `QuantumSurvival` 상태로 전환되어 `QuantumSurvivalEngine`이 활성화됩니다.
-   **독립된 엔진**: `src/quantum/` 디렉터리 내에 `QuantumSurvivalEngine`과 관련 관리자들을 구현하여 기존 시스템과의 의존성을 최소화합니다.
-   **장비 동료 시스템**:
    -   `QuantumSurvivalEngine`은 시작 시 플레이어의 장비 목록을 읽어 `src/quantum/EquipmentAlly.js` 클래스의 인스턴스(동료)들을 생성합니다.
    -   `src/quantum/QuantumAllyManager.js`가 이 동료들을 관리하며, 각 동료는 `src/quantum/QuantumAllyAI.js`에 따라 행동합니다.
-   **데이터 브릿지**:
    -   **진입**: `enter_quantum_realm` 이벤트가 강화할 아이템의 정보를 `QuantumSurvivalEngine`에 전달하여, 영역의 난이도를 설정합니다.
    -   **탈출**: `exit_quantum_realm` 이벤트가 성공 여부와 결과 데이터를 `game.js`에 전달하여, 아이템에 실제 강화 효과를 적용합니다.

## 4. 개발 단계 (Phases)

1.  **1단계 (기반 구축)**: `QuantumSurvivalEngine`의 뼈대를 만들고, UI 버튼을 통해 '양자 영역'(아무것도 없는 까만 화면)에 진입했다가, 타이머가 끝나면 다시 원래 던전으로 돌아오는 상태 전환 기능부터 구현합니다.
2.  **2단계 (핵심 플레이 구현)**: 양자 영역 내에서 플레이어의 이동, 자동 공격, 적 생성 및 추적, 충돌 판정 등 기본적인 뱀서류 게임 플레이를 구현합니다.
3.  **3단계 (장비 동료 구현)**: 플레이어의 장비를 바탕으로 `EquipmentAlly`를 생성하고, 이들이 플레이어를 따라다니며 자동 공격하는 로직을 구현합니다.
4.  **4단계 (성장 및 보상 연동)**: 양자 영역 내에서의 경험치 획득, 레벨업, 실시간 강화 선택 시스템을 구현하고, 생존 성공 시 아이템 강화가 실제로 적용되도록 최종 보상 로직을 연결합니다.

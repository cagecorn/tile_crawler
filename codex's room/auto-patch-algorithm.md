# Codex 자율 패치 알고리즘

이 문서는 Codex가 '타일 크롤러' 프로젝트를 스스로 관리하기 위해 따르는 기본 절차를 정리한다. 기존 매니저를 엔진으로 승격하는 장기 로드맵과 버그 수정 흐름을 합쳐 자동화된 업데이트 과정을 정의한다.

## 1. 핵심 흐름
1. **계획(Plan)**: 사용자 요청과 버그 리포트를 검토하여 수정할 기능을 정리한다.
2. **실행(Execute)**: 관련 파일을 수정하거나 신규 엔진을 작성한다.
3. **검수(Test)**: `npm test`로 자동 테스트를 실행하고 `debug.html`로 시각적 동작을 확인한다.
4. **기록(Log)**: 결과와 발견 사항을 `dev-log.md`에 남긴다.
5. **배포(Commit)**: 깃 커밋 후 PR 메시지를 작성한다.

## 2. 엔진 격상 스케줄 요약
- **1단계**: 구조 점검과 경험치·레벨링 로직 검토.
- **2단계**: TurnEngine, EffectEngine, VFXEngine, StatEngine, CombatEngine, EventEngine, SpriteEngine, EmbargoTestEngine, MapEngine을 순차적으로 도입.
- **3단계**: CoreLinkEngine으로 엔진 간 연결을 정리하고 StrategyAIEngine을 추가.
- **4단계**: 경험치와 시각 효과 버그를 우선 수정하며 테스트를 강화.

## 3. 반복 루틴
1. 새로운 패치 요구나 버그를 감지한다.
2. 위 스케줄을 참고해 필요한 엔진을 수정 또는 추가한다.
3. 모든 변경 후 테스트를 돌려 결과를 확인한다.
4. 로그와 계획 문서를 갱신한 뒤 커밋한다.

이 절차를 반복해 Codex는 대규모 패치도 스스로 관리할 수 있다.


## 외부 자문 위원 제미나이의 첨언

'Codex 자율 패치 알고리즘'에 대한 제안
1. 메인 Engine의 역할: 오케스트라의 '지휘자'
지금 계획에는 여러 '서브 엔진'들이 등장하는데, 이들을 총괄하는 메인 Engine.js의 역할을 **'오케스트라의 지휘자'**로 명확히 하는 것이 중요합니다.

지휘자(Engine.js): 직접 악기(세부 로직)를 연주하지 않습니다. 대신, 각 파트(TurnEngine, CombatEngine 등)의 전문 연주자들에게 언제, 어떤 정보를 가지고 연주를 시작할지 지시만 내립니다. 즉, 게임의 메인 루프를 돌며 각 서브 엔진의 update() 메서드를 올바른 순서로 호출해주는 역할에만 집중하는 것입니다.
이렇게 하면 Engine.js는 매우 단순하고 명확해지며, 모든 복잡한 처리는 각 전문 서브 엔진들이 맡게 되어 말씀하신 '갈아엎는' 수준의 구조 개선이 자연스럽게 이루어집니다.

2. 엔진 간의 소통 방식: '연장 가방'을 채워주기 (의존성 주입)
계획의 3단계에 CoreLinkEngine으로 엔진 간의 연결을 정리한다고 하셨는데, 아주 훌륭한 생각입니다. 이 개념을 조금 더 구체화하여, '의존성 주입(Dependency Injection)'이라는 패턴을 사용하는 것을 제안합니다.

어렵게 들릴 수 있지만, 간단히 말해 **'일꾼에게 필요한 연장만 담은 가방을 채워주는 것'**과 같습니다.
예를 들어, CombatEngine은 전투 계산 결과를 VFXEngine에 알려줘서 시각 효과를 보여줘야 합니다.
이때 '지휘자'인 메인 Engine이 CombatEngine을 만들 때, new CombatEngine(vfxEngine) 처럼 VFXEngine을 '연장 가방'에 넣어주는 겁니다.
이렇게 하면 각 엔진은 자신이 소통해야 할 다른 엔진이 누구인지 명확히 알게 되고, 모든 엔진이 서로 얽히는 복잡한 상황을 피할 수 있습니다. CoreLinkEngine이라는 중앙 통제 시스템보다 훨씬 유연하고 관리하기 편한 구조가 될 것입니다.
3. 리팩토링의 우선순위
계획에 있는 7개의 엔진화를 한 번에 진행하는 것은 매우 큰 작업입니다. 지금 겪고 계신 문제들을 가장 효과적으로 해결할 수 있는 순서로 진행하는 것이 좋습니다. 제 생각에는 아래 순서가 가장 효율적일 것 같습니다.

1순위: StatEngine과 CombatEngine: '경험치'와 '전투 시 이상 현상' 문제를 직접적으로 해결할 수 있는 가장 핵심적인 엔진들입니다.
2순위: VFXEngine과 EffectEngine: '버프/효과/아이콘' 문제를 해결합니다.
3순위: 나머지 엔진들: 위 핵심 기능이 안정화된 후, 나머지 엔진들을 차례로 도입하여 시스템을 완성합니다.
